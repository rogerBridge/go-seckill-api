# å•ä½“rediså•†å“æŠ¢è´­Demo

- æ€è·¯

    ç”¨æˆ·è¯·æ±‚çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸º: ç”¨æˆ·Id, å•†å“Id, å•†å“æ•°é‡, å…¶ä¸­, ç”¨æˆ·Idé»˜è®¤æ˜¯ç»è¿‡ç½‘å…³æ ¡éªŒçš„, è¿™é‡Œä¸åšéªŒè¯.
    
- ç‰¹å¾:

    - [x] æ”¯æŒå¤šä¸ªå•†å“åº“å­˜åˆå§‹åŒ–, åŒæ—¶æŠ¢è´­
    - [x] é™åˆ¶ç”¨æˆ·æ˜¯å¦å¯è´­ä¹°, å¯è´­ä¹°çš„å•†å“çš„æ€»æ•°é‡(userFilterå‡½æ•°å†…å®¹å¯ä»¥è‡ªå®šä¹‰)
    - [x] æ”¯æŒè®¢å•å–æ¶ˆ
    - [x] è®¢å•å·ä½¿ç”¨ksuid, ç±»ä¼¼äºuuid
    - [ ] ç”Ÿæˆè®¢å•åå†…å®¹ä¼ è¾“ç»™é˜Ÿåˆ—, å¦‚rabbitmq, å†™å…¥Mysqlæ•°æ®åº“
    - [ ] å®Œå–„å‰ç«¯+ç”¨æˆ·ID(åˆæ³•æ€§, cookieæˆ–è€…token)æ ¡éªŒ

- åº”ç”¨æƒ…æ™¯

    1. å–å‡ºå•†å“a 100ä»¶, é™åˆ¶æ¯ä¸ªäººåªèƒ½è´­ä¹°åŒæ¬¾å•†å“1ä»¶;
    2. å–å‡ºå•†å“a 100ä»¶, å•†å“b 100ä»¶, å•†å“aé™åˆ¶æ¯ä¸ªäººåªèƒ½è´­ä¹°2ä»¶, å•†å“bé™åˆ¶æ¯ä¸ªäººåªèƒ½è´­ä¹°1ä»¶;
    3. å–å‡ºå•†å“a xä»¶(x>0 && type(x)=="int"), é™è´­aaä»¶(aa<=x). å•†å“b yä»¶(y>0 && type(y)=="int"), é™è´­bbä»¶(bb<=y), å•†å“c zä»¶(z>0&& type(z)=="int"), é™è´­ccä»¶(cc<=z) ......, 
    
    
- æµç¨‹
    

- éƒ¨ç½²æ–¹æ³•

    - æ‰“åŒ…æˆäºŒè¿›åˆ¶æ–‡ä»¶, é€šè¿‡nginxè½¬å‘, æˆ–è€…ç›´æ¥ä½¿ç”¨è£¸äºŒè¿›åˆ¶æ–‡ä»¶
        1. éƒ¨ç½²redis, ç«¯å£å·: 6379, AUTH: "hello"
        2. cd redis_play && go build -o redis_play *.go && ./redis_play
        3. è¿è¡Œredis_play, é»˜è®¤æƒ…å†µä¸‹, redisåªèƒ½é€šè¿‡localhostè¿æ¥, ä¸ºäº†å®‰å…¨å˜›~, é€šè¿‡httpæ¥è°ƒç”¨rediså°±å¥½äº†å‘€, ç„¶åæŠŠç«¯å£æš´éœ²ç»™å…¬ç½‘.
        4. å¯ä»¥ä½¿ç”¨Postmanæµ‹è¯•åŠŸèƒ½, è‡ªå·±å†™æˆ–è€…ç”¨æˆ‘çš„ä½äºpressure_testç›®å½•ä¸‹çš„å‹æµ‹è„šæœ¬æµ‹è¯•å¹¶å‘æ€§èƒ½, 
           ç›®å‰åªè¦†ç›–äº†ä¸¤ç§åœºæ™¯(1. 20000åç”¨æˆ·åŒæ—¶æŠ¢è´­productId: 10000çš„å•†å“(åº“å­˜:200), 2. 20000åç”¨æˆ·åŒæ—¶æŠ¢è´­2ç§å•†å“, productId:10000, productId:10001, per 200ä»¶åº“å­˜)
    - åšæˆdocker
        æ‡’é“¶ä¸€ä¸ª, è¿˜æ²¡åŠ¨æ‰‹å‘ğŸ˜‰

- æ³¨æ„:

    1. redis.confé‡Œé¢çš„maxclientsé»˜è®¤æ˜¯10000, æˆ‘å‘ç°ç”¨20000clientså»æµ‹è¯•çš„æ—¶å€™, ä¼šæŠ¥é”™, å› ä¸ºserverä¸èƒ½æ‰¿å—å¤ªå¤§é‡çš„clients conn, æ‰€ä»¥æœ€å¥½ä¿®æ”¹çš„å¤§ä¸€ç‚¹å§(ğŸ˜‰æˆ‘å°±æ”¹äº†10w)

- æ€§èƒ½æµ‹è¯•

    - æµ‹è¯•åœºæ™¯
    
        ç³»ç»Ÿ: Ubuntu 20.04 LTS
    
        CPU: Intel i5 8250U (4H8T) (runtime.GOMAXPROCSè®¾ç½®ä¸º1ä¸ªçº¿ç¨‹, ä½†é€šè¿‡htopå‘ç°, 8ä¸ªçº¿ç¨‹å…¨éƒ¨è¢«å ç”¨äº†, æˆ‘ä¹Ÿä¸çŸ¥é“å’‹å›äº‹,  This call will go away when the scheduler improves, æ„æ€æ˜¯å‡çº§äº†scheduleræ‰€ä»¥è¿™ä¸ªgo swayäº†?)
    
        go version: go1.14.4 linux/amd64
        
        å†…å­˜å ç”¨(åå¤è·‘pressure_testååœåœ¨äº†è¿™ä¸ªåœ°æ–¹, peak value 868MB):
    ![pressure_test_memory](./img/pressure.png)
    1. ç”¨æˆ·20000å, åŒæ—¶è¯·æ±‚: /buy, è´­ä¹°å•†å“, å•†å“ID: "10000", è´­ä¹°æ•°é‡: 1åº“å­˜æ•°é‡: 200ä»¶, æµ‹è¯•ç»“æœå¦‚ä¸‹:
    
    ç¬¬ä¸€æ¬¡æµ‹è¯•:
    
    ![1.1](./img/1.1.png)
    
    æ£€æŸ¥redis-db0, å‘ç°æ²¡æœ‰è¶…å–, è®¢å•ç”Ÿæˆæ­£å¸¸, ç”¨æˆ·è´­ç‰©è½¦æ•°å€¼æ­£å¸¸
    
    ç¬¬äºŒæ¬¡æµ‹è¯•:
    
    ![1.2](./img/1.2.png)
    
    ç¬¬ä¸‰æ¬¡æµ‹è¯•:
    
    ![1.3](./img/1.3.png)
    
    2. 20000åç”¨æˆ·, å…¶ä¸­10000åç”¨æˆ·æŠ¢è´­å•†å“"10000", åº“å­˜ä¸º200, 10000åç”¨æˆ·æŠ¢è´­å•†å“"10001", æ•°é‡ä¸º200, æµ‹è¯•ç»“æœå¦‚ä¸‹:
    
    ç¬¬ä¸€æ¬¡æµ‹è¯•:
    
    ![2.1](./img/2.1.png)
    æ£€æŸ¥redis-db0, å‘ç°æ²¡æœ‰è¶…å–, è®¢å•ç”Ÿæˆæ­£å¸¸, ç”¨æˆ·è´­ç‰©è½¦æ•°å€¼æ­£å¸¸
  
    ç¬¬äºŒæ¬¡æµ‹è¯•:
    
    ![2.2](./img/2.2.png)
    
    ç¬¬ä¸‰æ¬¡æµ‹è¯•:
    
    ![2.3](./img/2.3.png)